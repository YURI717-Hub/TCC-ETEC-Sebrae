<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro - Auto Peças Express</title>
    <link rel="stylesheet" href="../css/headerfooter.css">
    <link rel="stylesheet" href="../css/cadastro.css">
<script src="../js/menu.js"></script>

    <style>
        .selecao-tipo {
            text-align: center;
            margin-top: 40px;
        }

        .tipo-btn {
            padding: 12px 25px;
            margin: 10px;
            border: none;
            background-color: #ff1e00;
            color: white;
            border-radius: 6px;
            font-size: 18px;
            cursor: pointer;
        }

        .tipo-btn:hover {
            background-color: #ffffff;
            color: #ff1e00;
            border: #ff1e00 1px solid; 
        }

        /* Esconder os formulários inicialmente */
        #formUsuario, #formFornecedor {
            display: none;
        }
    </style>
</head>

<body>
 <header>
  <div class="navbar">

    <div class="header-linear-content">

      <a href="../../home.html">
        <h1 class="logo"> AutoPeças <span> Express </span></h1>
      </a>

      <nav>
        <ul>
          <li><a href="perfil.html">Meu Perfil</a></li>
          <li><a href="produto.html">Produtos</a></li>
          <li><a href="sobre.html">Sobre</a></li>
        </ul>
      </nav>

      

      <div class="right-items">

        <figure class="nav-icon-container">
          <a href="carrinho.html">
            <img src="../images/carrinho.png" alt="">
          </a>
        </figure>

        <ul class="login">
          <li><a href="login.html">Entrar</a></li>
          <li>|</li>
          <li><a href="cadastro.html">Cadastro</a></li>
        </ul>

        <figure>
          <img onload="menu();" src="../images/menu.png" alt="" class="menu-button">
        </figure>

      </div>

    </div>

  </div>
</header>
<br><br><br>

<hr>
<br>


<div class="selecao-tipo" id="selecaoTipo">
    <h2>Como deseja se cadastrar?</h2>
    <button class="tipo-btn" id="btnUsuario">Sou Cliente</button>
    <button class="tipo-btn" id="btnFornecedor">Sou Fornecedor</button>
</div>


<div id="formUsuario">
    <div class="cadastro-container">
        <h2 class="cadastro-title">Criar Conta - Usuário</h2>

        <form id="formCadastroUsuario">

            <div class="linha">
                <div class="campo">
                    <label>* Nome completo</label>
                    <input type="text" id="nome" required>
                </div>

                <div class="campo">
                    <label>* CPF</label>
                    <input type="text" id="cpf" required>
                </div>
            </div>

            <div class="linha">
                <div class="campo">
                    <label>* E-mail</label>
                    <input type="email" id="email" required>
                </div>

                <div class="campo">
                    <label>* Confirme E-mail</label>
                    <input type="email" id="confEmail" required>
                </div>
            </div>

            <div class="linha">
                <div class="campo">
                    <label>* Senha</label>
                    <input type="password" id="senha" required>
                </div>

                <div class="campo">
                    <label>* Confirme a senha</label>
                    <input type="password" id="confSenha" required>
                </div>
            </div>

            <div class="form-group">
                <label for="client-cep">* CEP</label>
                <input type="text" id="client-cep" placeholder="00000-000" required>
            </div>

            <div id="endereco-bloco" style="display:none;">

                <div class="form-group">
                    <label>* Endereço</label>
                    <input type="text" id="client-rua">
                </div>

                <div class="form-group">
                    <label>* Número</label>
                    <input type="text" id="client-numero">
                </div>

                <div class="form-group">
                    <label>* Bairro</label>
                    <input type="text" id="client-bairro">
                </div>

                <div class="form-group">
                    <label>* Cidade</label>
                    <input type="text" id="client-cidade">
                </div>

                <div class="form-group">
                    <label>* Estado</label>
                    <input type="text" id="client-estado">
                </div>

            </div>

            <div class="checkbox-area">
                <label>
                    <input type="checkbox" id="termos" required>
                    Aceito os termos de <a href="#">Privacidade</a> e <a href="#">Trocas e Devoluções</a>
                </label>
            </div>

            <button type="button" class="btn-cadastrar" id="btn-cadastrar-usuario">CADASTRAR</button>
        </form>
    </div>
</div>


<div id="formFornecedor">
    <div class="cadastro-container">
        <h2 class="cadastro-title">Cadastro de Fornecedor</h2>

        <form id="formCadastroFornecedor">
            <div class="campo">
                <label>* Nome da Empresa</label>
                <input type="text" id="forn-nome" required>
            </div>

            <div class="campo">
                <label>* CNPJ</label>
                <input type="text" id="forn-cnpj" required>
            </div>

            <div class="campo">
                <label>* E-mail Comercial</label>
                <input type="email" id="forn-email" required>
            </div>

            <div class="campo">
                <label>* Telefone</label>
                <input type="text" id="forn-tel" required>
            </div>

            <div class="form-group">
                <label>* CEP</label>
                <input type="text" id="forn-cep" required>
            </div>

            <div id="endereco-fornecedor" style="display:none;">
                <div class="form-group">
                    <label>* Endereço</label>
                    <input type="text" id="forn-rua">
                </div>

                <div class="form-group">
                    <label>* Número</label>
                    <input type="text" id="forn-numero">
                </div>

                <div class="form-group">
                    <label>* Bairro</label>
                    <input type="text" id="forn-bairro">
                </div>

                <div class="form-group">
                    <label>* Cidade</label>
                    <input type="text" id="forn-cidade">
                </div>

                <div class="form-group">
                    <label>* Estado</label>
                    <input type="text" id="forn-estado">
                </div>
            </div>

            <button type="button" class="btn-cadastrar" id="btn-cadastrar-fornecedor">CADASTRAR FORNECEDOR</button>
        </form>
    </div>
</div>

<br><br><br>
<script>
        document.getElementById("btnUsuario").onclick = () => {
        document.getElementById("selecaoTipo").style.display = "none";
        document.getElementById("formUsuario").style.display = "block";
    };

    document.getElementById("btnFornecedor").onclick = () => {
        document.getElementById("selecaoTipo").style.display = "none";
        document.getElementById("formFornecedor").style.display = "block";
    };

</script>

<script type="module">
import { 
    auth, 
    db, 
    ref, 
    set, 
    createUserWithEmailAndPassword
} from "../js/firebaseConfig.js";




// ======================================================
//        BUSCA CEP USUÁRIO
// ======================================================
document.getElementById("client-cep").addEventListener("blur", async () => {
    const cep = document.getElementById("client-cep").value.replace(/\D/g, "");

    if (cep.length !== 8) return alert("CEP inválido!");

    const data = await fetch(`https://viacep.com.br/ws/${cep}/json/`).then(r => r.json());

    if (data.erro) return alert("CEP não encontrado!");

    document.getElementById("client-rua").value = data.logradouro;
    document.getElementById("client-bairro").value = data.bairro;
    document.getElementById("client-cidade").value = data.localidade;
    document.getElementById("client-estado").value = data.uf;

    document.getElementById("endereco-bloco").style.display = "block";
});

// ======================================================
//       BUSCA CEP FORNECEDOR
// ======================================================
document.getElementById("forn-cep").addEventListener("blur", async () => {
    const cep = document.getElementById("forn-cep").value.replace(/\D/g, "");

    if (cep.length !== 8) return alert("CEP inválido!");

    const data = await fetch(`https://viacep.com.br/ws/${cep}/json/`).then(r => r.json());

    if (data.erro) return alert("CEP não encontrado!");

    document.getElementById("forn-rua").value = data.logradouro;
    document.getElementById("forn-bairro").value = data.bairro;
    document.getElementById("forn-cidade").value = data.localidade;
    document.getElementById("forn-estado").value = data.uf;

    document.getElementById("endereco-fornecedor").style.display = "block";
});

// ======================================================
//       CADASTRAR USUÁRIO
// ======================================================
document.getElementById("btn-cadastrar-usuario").onclick = async () => {

    const email = document.getElementById("email").value;
    const senha = document.getElementById("senha").value;

    const userCredential = await createUserWithEmailAndPassword(auth, email, senha);
    const user = userCredential.user;

    await set(ref(db, "usuarios/" + user.uid), {
        nome: document.getElementById("nome").value,
        cpf: document.getElementById("cpf").value,
        email: email,
        cep: document.getElementById("client-cep").value
    });

    // ⬇⬇⬇ REDIRECIONAMENTO
    window.location.href = "login.html";
};

// ======================================================
//       CADASTRAR FORNECEDOR
// ======================================================
document.getElementById("btn-cadastrar-fornecedor").onclick = async () => {

    const email = document.getElementById("forn-email").value;
    const senha = "123456"; // senha padrão

    const userCredential = await createUserWithEmailAndPassword(auth, email, senha);
    const user = userCredential.user;

    await set(ref(db, "fornecedores/" + user.uid), {
        empresa: document.getElementById("forn-nome").value,
        cnpj: document.getElementById("forn-cnpj").value,
        email: email,
        telefone: document.getElementById("forn-tel").value,
        cep: document.getElementById("forn-cep").value
    });



    // ⬇⬇⬇ REDIRECIONAMENTO
    window.location.href = "perfilFornecedor.html";
};
</script>



</body>
</html>
